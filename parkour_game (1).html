<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cima Eterna — Only Up Clone</title>
<style>
  html,body{ margin:0; overflow:hidden; height:100%; background:#0b1020; }
  canvas{ display:block; }
</style>
</head>
<body>
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js';
import * as CANNON from 'https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.js';

// --- Escena ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b1020);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- Luz ---
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10,20,10);
scene.add(light);
scene.add(new THREE.AmbientLight(0xffffff,0.4));

// --- Mundo físico ---
const world = new CANNON.World({gravity: new CANNON.Vec3(0,-30,0)});
world.broadphase = new CANNON.NaiveBroadphase();

// --- Suelo y plataformas ---
function createPlatform(x,y,z,w,h,d){
  const shape = new CANNON.Box(new CANNON.Vec3(w/2,h/2,d/2));
  const body = new CANNON.Body({mass:0, shape:shape, position:new CANNON.Vec3(x,y,z)});
  world.addBody(body);

  const geo = new THREE.BoxGeometry(w,h,d);
  const mat = new THREE.MeshStandardMaterial({color:0x5b6b7a});
  const mesh = new THREE.Mesh(geo, mat);
  mesh.position.copy(body.position);
  scene.add(mesh);
  return {body, mesh};
}

const platforms = [];
platforms.push(createPlatform(0,0,0,3,0.5,3));
platforms.push(createPlatform(5,3,0,3,0.5,3));
platforms.push(createPlatform(-5,6,2,3,0.5,3));
platforms.push(createPlatform(0,9,-3,3,0.5,3));
platforms.push(createPlatform(3,12,1,3,0.5,3));

// --- Jugador ---
const playerShape = new CANNON.Box(new CANNON.Vec3(0.25,0.5,0.25));
const playerBody = new CANNON.Body({mass:1, shape:playerShape, position:new CANNON.Vec3(0,1,0), linearDamping:0.9});
world.addBody(playerBody);

const playerGeo = new THREE.BoxGeometry(0.5,1,0.5);
const playerMat = new THREE.MeshStandardMaterial({color:0x7bd389});
const playerMesh = new THREE.Mesh(playerGeo, playerMat);
scene.add(playerMesh);

// --- Controles ---
const keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// --- Animación ---
function animate(){
  requestAnimationFrame(animate);

  // Control del jugador
  const speed = 5;
  if(keys['a']) playerBody.velocity.x = -speed;
  if(keys['d']) playerBody.velocity.x = speed;
  if(keys['w']) playerBody.velocity.z = -speed;
  if(keys['s']) playerBody.velocity.z = speed;
  if(keys[' '] && Math.abs(playerBody.velocity.y)<0.05) playerBody.velocity.y = 10;

  // Paso físico
  world.step(1/60);

  // Actualizar mesh
  playerMesh.position.copy(playerBody.position);
  playerMesh.quaternion.copy(playerBody.quaternion);
  platforms.forEach(p=>p.mesh.position.copy(p.body.position));

  // Cámara tercera persona
  camera.position.lerp(new THREE.Vector3(playerBody.position.x+5,playerBody.position.y+5,playerBody.position.z+10),0.1);
  camera.lookAt(playerBody.position);

  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
